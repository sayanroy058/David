{% extends 'base_new.html' %}
{% block title %}Your Cart{% endblock %}

{% block extra_css %}
<style>
/* Fix navigation responsiveness */
@media (max-width: 1199px) {
  .master-search-container {
    max-width: 400px;
  }
  
  .search-category-dropdown {
    min-width: 80px;
    font-size: 13px;
  }
}

@media (max-width: 991px) {
  .navbar-nav {
    text-align: center;
  }
  
  .nav-item {
    margin: 5px 0;
  }
}

/* Fix navbar overflow issues */
.navbar {
  overflow: visible;
}

.navbar-brand {
  flex-shrink: 0;
}

.master-search-container {
  flex: 1;
  min-width: 0;
}

/* Ensure proper container behavior */
.container-fluid {
  width: 100%;
  padding-right: var(--bs-gutter-x, 0.75rem);
  padding-left: var(--bs-gutter-x, 0.75rem);
  margin-right: auto;
  margin-left: auto;
}

/* Bundle-specific styling */
.bundle-item {
  background-color: rgba(255, 193, 7, 0.05);
  border-left: 3px solid #ffc107;
}

.bundle-card {
  border-left: 3px solid #ffc107 !important;
  background-color: rgba(255, 193, 7, 0.02);
}

.bundle-preview img {
  border: 1px solid #dee2e6;
  box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.bundle-book-title {
  display: block;
  font-size: 10px;
  color: #333;
  max-width: 60px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  margin-top: 2px;
}

.bundle-item .collapse .card-body {
  background-color: rgba(248, 249, 250, 0.8);
  border-radius: 0.375rem;
}

.bundle-card .collapse {
  background-color: rgba(248, 249, 250, 0.5);
  border-radius: 0.375rem;
}

/* Fix navbar collapse on smaller screens */
@media (max-width: 1199px) {
  .navbar-nav {
    flex-wrap: wrap;
  }
  
  .nav-item {
    flex-shrink: 0;
  }
}

/* Improve search bar responsiveness */
@media (max-width: 1399px) {
  .master-search-input {
    min-width: 200px;
  }
}

@media (max-width: 1199px) {
  .master-search-input {
    min-width: 150px;
  }
}

/* Responsive table improvements */
.table-responsive {
  border-radius: 8px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

/* Mobile cart improvements */
@media (max-width: 767px) {
  .btn-lg {
    padding: 12px 20px;
    font-size: 16px;
  }
  
  .container-fluid {
    padding-left: 10px;
    padding-right: 10px;
  }
  
  .card-body {
    padding: 15px;
  }
  
  h2 {
    font-size: 1.5rem;
  }
}

/* Tablet improvements */
@media (min-width: 768px) and (max-width: 991px) {
  .master-search-container {
    max-width: 300px;
  }
  
  .navbar-nav .nav-link {
    padding: 8px 12px;
    font-size: 14px;
  }
}

/* Prevent horizontal scroll */
body {
  overflow-x: hidden;
}

.row {
  margin-left: 0;
  margin-right: 0;
}

.col-12 {
  padding-left: 0;
  padding-right: 0;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-3 px-md-4 py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-xl-10">
      <h2 class="text-center mb-4 fw-bold text-dark">Your Shopping Cart</h2>

      {% if cart and cart|length > 0 %}
      
      <!-- Desktop View -->
      <div class="d-none d-lg-block">
        <div class="card border-0 shadow-sm">
          <div class="table-responsive">
            <table class="table table-hover mb-0" style="min-width: 800px;">
              <thead class="table-primary">
                <tr>
                  <th class="py-3" style="width: 35%;">Product</th>
                  <th class="py-3" style="width: 15%;">Details</th>
                  <th class="py-3" style="width: 12%;">Price</th>
                  <th class="py-3" style="width: 8%;">Qty</th>
                  <th class="py-3" style="width: 12%;">Total</th>
                  <th class="py-3 text-center" style="width: 10%;">Action</th>
                </tr>
              </thead>
              <tbody>
                {% set grand_total = namespace(value=0) %}
                {% for item in cart %}
                  {% set item_total = item.price * item.quantity %}
                  {% set grand_total.value = grand_total.value + item_total %}
                  
                  {% if item.get('type') == 'bundle' %}
                    <!-- Bundle Item Row -->
                    <tr class="bundle-item">
                      <td class="py-3">
                        <div class="d-flex align-items-center">
                          <div class="bundle-preview me-3">
                            {% if item.books %}
                              <div class="d-flex flex-wrap" style="width: 50px;">
                                {% for book in item.books[:4] %}
                                  {% if book.image %}
                                    <div class="position-relative">
                                      <img src="{{ url_for('static', filename='uploads/books/' ~ book.image) }}" 
                                           alt="{{ book.title }}" 
                                           class="rounded mb-1 me-1"
                                           style="width: 20px; height: 25px; object-fit: contain;">
                                      <span class="bundle-book-title d-none d-md-block position-absolute" style="font-size: 8px;">{{ book.title|truncate(10) }}</span>
                                    </div>
                                  {% endif %}
                                {% endfor %}
                              </div>
                            {% else %}
                              <div class="bg-light rounded d-flex align-items-center justify-content-center" 
                                   style="width: 50px; height: 65px;">
                                <i class="bi bi-collection text-muted"></i>
                              </div>
                            {% endif %}
                          </div>
                          <div class="flex-grow-1 min-width-0">
                            <h6 class="mb-1 fw-semibold text-truncate">{{ item.title }}</h6>
                            <small class="text-muted">
                              Bundle ({{ item.books|length }} books)
                              <button class="btn btn-link btn-sm p-0 ms-2" type="button" 
                                      data-bs-toggle="collapse" 
                                      data-bs-target="#bundle-{{ item.id }}" 
                                      aria-expanded="false">
                                <i class="bi bi-chevron-down"></i> View Books
                              </button>
                            </small>
                          </div>
                        </div>
                      </td>
                      <td class="py-3">
                        <span class="badge bg-warning text-dark mb-1">Bundle</span><br>
                        <small class="text-muted">{{ item.books|length }} books included</small>
                      </td>
                      <td class="py-3">
                        <span class="fw-bold text-success">‚Çπ{{ "%.2f"|format(item.price) }}</span>
                        <br><small class="text-muted">Bundle Price</small>
                      </td>
                      <td class="py-3">
                        <span class="badge bg-light text-dark">
                          <i class="bi bi-collection me-1"></i>{{ item.quantity }}
                        </span>
                      </td>
                      <td class="py-3">
                        <span class="fw-bold">‚Çπ{{ "%.2f"|format(item_total) }}</span>
                      </td>
                      <td class="py-3 text-center">
                        <a href="{{ url_for('remove_from_cart_generic', item_type='bundle', item_id=item.id) }}" 
                           class="btn btn-outline-danger btn-sm">
                          <i class="bi bi-trash"></i>
                        </a>
                      </td>
                    </tr>
                    <!-- Expandable Bundle Books -->
                    <tr>
                      <td colspan="6" class="p-0">
                        <div class="collapse" id="bundle-{{ item.id }}">
                          <div class="bg-light border-top">
                            <div class="p-3">
                              <h6 class="mb-3 text-primary"><i class="bi bi-collection me-2"></i>Books in this Bundle</h6>
                              <div class="row g-3">
                                {% for book in item.books %}
                                  <div class="col-lg-6 col-xl-4">
                                    <div class="card h-100 border-0 shadow-sm">
                                      <div class="card-body p-3">
                                        <div class="d-flex align-items-start">
                                          {% if book.image %}
                                            <img src="{{ url_for('static', filename='uploads/books/' ~ book.image) }}" 
                                                 alt="{{ book.title }}" 
                                                 class="rounded me-3 flex-shrink-0"
                                                 style="width: 45px; height: 60px; object-fit: contain;">
                                          {% else %}
                                            <div class="bg-primary bg-opacity-10 rounded me-3 d-flex align-items-center justify-content-center flex-shrink-0" 
                                                 style="width: 45px; height: 60px;">
                                              <i class="bi bi-book text-primary"></i>
                                            </div>
                                          {% endif %}
                                          <div class="flex-grow-1 min-width-0">
                                            <h6 class="mb-1 fw-semibold text-truncate" style="font-size: 0.9rem;">{{ book.title }}</h6>
                                            <p class="mb-1 text-muted small">by {{ book.author }}</p>
                                            <div class="d-flex justify-content-between align-items-center">
                                              <span class="fw-bold text-success">‚Çπ{{ "%.2f"|format(book.price) }}</span>
                                              {% if book.categories %}
                                                <span class="badge bg-primary bg-opacity-10 text-primary small">{{ book.categories[0].name }}</span>
                                              {% endif %}
                                            </div>
                                          </div>
                                        </div>
                                      </div>
                                    </div>
                                  </div>
                                {% endfor %}
                              </div>
                              <div class="mt-3 pt-2 border-top">
                                <div class="row align-items-center">
                                  <div class="col-sm-6">
                                    <small class="text-muted">
                                      <i class="bi bi-info-circle me-1"></i>
                                      Total {{ item.books|length }} books ‚Ä¢ Individual price: ‚Çπ{{ "%.2f"|format(item.books|sum(attribute='price')) }}
                                    </small>
                                  </div>
                                  <div class="col-sm-6 text-sm-end mt-2 mt-sm-0">
                                    <span class="badge bg-success">
                                      <i class="bi bi-tag me-1"></i>
                                      Bundle Savings: ‚Çπ{{ "%.2f"|format((item.books|sum(attribute='price')) - item.price) }}
                                    </span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </td>
                    </tr>
                  {% elif item.get('type') == 'course' %}
                    <!-- Course Item Row -->
                    <tr>
                      <td class="py-3">
                        <div class="d-flex align-items-center">
                          {% if item.image %}
                            <img src="{{ url_for('static', filename='uploads/courses/' ~ item.image) }}" 
                                 alt="{{ item.title }}" 
                                 class="rounded me-3 flex-shrink-0"
                                 style="width: 50px; height: 65px; object-fit: contain;">
                          {% else %}
                            <div class="bg-light rounded me-3 d-flex align-items-center justify-content-center flex-shrink-0" 
                                 style="width: 50px; height: 65px;">
                              <i class="bi bi-play-circle text-muted"></i>
                            </div>
                          {% endif %}
                          <div class="flex-grow-1 min-width-0">
                            <h6 class="mb-1 fw-semibold text-truncate">{{ item.title }}</h6>
                            <small class="text-muted text-truncate d-block">Certificate Course</small>
                          </div>
                        </div>
                      </td>
                      <td class="py-3">
                        <div>
                          <span class="badge bg-success mb-1">Course</span><br>
                          <small class="text-muted">Online Learning</small>
                        </div>
                      </td>
                      <td class="py-3">
                        <span class="fw-bold text-success">‚Çπ{{ "%.2f"|format(item.price) }}</span>
                      </td>
                      <td class="py-3">
                        <span class="badge bg-light text-dark">{{ item.quantity }}</span>
                      </td>
                      <td class="py-3">
                        <span class="fw-bold">‚Çπ{{ "%.2f"|format(item_total) }}</span>
                      </td>
                      <td class="py-3 text-center">
                        <a href="{{ url_for('remove_from_cart_generic', item_type='course', item_id=item.id) }}" 
                           class="btn btn-outline-danger btn-sm">
                          <i class="bi bi-trash"></i>
                        </a>
                      </td>
                    </tr>
                  {% else %}
                    <!-- Regular Book Item Row -->
                    <tr>
                      <td class="py-3">
                        <div class="d-flex align-items-center">
                          {% if item.image %}
                            <img src="{{ url_for('static', filename='uploads/books/' ~ item.image) }}" 
                                 alt="{{ item.title }}" 
                                 class="rounded me-3 flex-shrink-0"
                                 style="width: 50px; height: 65px; object-fit: contain;">
                          {% else %}
                            <div class="bg-light rounded me-3 d-flex align-items-center justify-content-center flex-shrink-0" 
                                 style="width: 50px; height: 65px;">
                              <i class="bi bi-book text-muted"></i>
                            </div>
                          {% endif %}
                          <div class="flex-grow-1 min-width-0">
                            <h6 class="mb-1 fw-semibold text-truncate">{{ item.title }}</h6>
                            <small class="text-muted text-truncate d-block">by {{ item.author }}</small>
                          </div>
                        </div>
                      </td>
                      <td class="py-3">
                        <div>
                          <span class="badge bg-primary mb-1">{{ item.category }}</span><br>
                          <small class="text-muted">{{ item.subject }}</small>
                        </div>
                      </td>
                      <td class="py-3">
                        <span class="fw-bold text-success">‚Çπ{{ "%.2f"|format(item.price) }}</span>
                      </td>
                      <td class="py-3">
                        <span class="badge bg-light text-dark">{{ item.quantity }}</span>
                      </td>
                      <td class="py-3">
                        <span class="fw-bold">‚Çπ{{ "%.2f"|format(item_total) }}</span>
                      </td>
                      <td class="py-3 text-center">
                        <a href="{{ url_for('remove_from_cart_generic', item_type='book', item_id=item.id) }}" 
                           class="btn btn-outline-danger btn-sm">
                          <i class="bi bi-trash"></i>
                        </a>
                      </td>
                    </tr>
                  {% endif %}
                {% endfor %}
              </tbody>
              <tfoot>
                <tr class="table-light">
                  <td colspan="4" class="py-3 text-end fw-bold">Grand Total:</td>
                  <td class="py-3 fw-bold text-success fs-5">‚Çπ{{ "%.2f"|format(grand_total.value) }}</td>
                  <td></td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </div>

      <!-- Mobile View -->
      <div class="d-lg-none">
        {% set grand_total = namespace(value=0) %}
        {% for item in cart %}
          {% set item_total = item.price * item.quantity %}
          {% set grand_total.value = grand_total.value + item_total %}
          
          {% if item.get('type') == 'bundle' %}
            <!-- Mobile Bundle Card -->
            <div class="card mb-3 border-0 shadow-sm bundle-card">
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-3">
                    {% if item.books %}
                      <div class="position-relative">
                        <div class="d-flex flex-wrap" style="height: 80px;">
                          {% for book in item.books[:4] %}
                            {% if book.image %}
                              <img src="{{ url_for('static', filename='uploads/books/' ~ book.image) }}" 
                                   alt="{{ book.title }}" 
                                   class="rounded me-1 mb-1"
                                   style="width: 35px; height: 45px; object-fit: contain;">
                            {% endif %}
                          {% endfor %}
                        </div>
                        {% if item.books|length > 4 %}
                          <small class="position-absolute bottom-0 end-0 badge bg-dark">+{{ item.books|length - 4 }}</small>
                        {% endif %}
                      </div>
                    {% else %}
                      <div class="bg-light rounded d-flex align-items-center justify-content-center" 
                           style="height: 80px;">
                        <i class="bi bi-collection text-muted"></i>
                      </div>
                    {% endif %}
                  </div>
                  <div class="col-9">
                    <h6 class="mb-1 fw-semibold">{{ item.title }}</h6>
                    <p class="mb-1 text-muted small">Bundle ({{ item.books|length }} books)</p>
                    <div class="mb-2">
                      <span class="badge bg-warning text-dark me-1">Bundle</span>
                      <button class="btn btn-link btn-sm p-0" type="button" 
                              data-bs-toggle="collapse" 
                              data-bs-target="#bundle-mobile-{{ item.id }}" 
                              aria-expanded="false">
                        <small><i class="bi bi-chevron-down"></i> View Books</small>
                      </button>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <span class="fw-bold text-success">‚Çπ{{ "%.2f"|format(item.price) }}</span>
                        <span class="text-muted"> √ó {{ item.quantity }}</span>
                      </div>
                      <div>
                        <span class="fw-bold me-2">‚Çπ{{ "%.2f"|format(item_total) }}</span>
                        <a href="{{ url_for('remove_from_cart_generic', item_type='bundle', item_id=item.id) }}" 
                           class="btn btn-outline-danger btn-sm">
                          <i class="bi bi-trash"></i>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- Expandable Book List -->
                <div class="collapse mt-3" id="bundle-mobile-{{ item.id }}">
                  <div class="border-top pt-3">
                    <h6 class="small fw-semibold mb-3 text-primary">
                      <i class="bi bi-collection me-1"></i>Books in this Bundle
                    </h6>
                    <div class="row g-2">
                      {% for book in item.books %}
                        <div class="col-12">
                          <div class="card border-0 bg-white shadow-sm">
                            <div class="card-body p-2">
                              <div class="d-flex align-items-center">
                                {% if book.image %}
                                  <img src="{{ url_for('static', filename='uploads/books/' ~ book.image) }}" 
                                       alt="{{ book.title }}" 
                                       class="rounded me-3 flex-shrink-0"
                                       style="width: 35px; height: 45px; object-fit: contain;">
                                {% else %}
                                  <div class="bg-primary bg-opacity-10 rounded me-3 d-flex align-items-center justify-content-center flex-shrink-0" 
                                       style="width: 35px; height: 45px;">
                                    <i class="bi bi-book text-primary small"></i>
                                  </div>
                                {% endif %}
                                <div class="flex-grow-1 min-width-0">
                                  <h6 class="mb-1 fw-semibold text-truncate" style="font-size: 0.85rem;">{{ book.title }}</h6>
                                  <p class="mb-1 text-muted small">by {{ book.author }}</p>
                                  <div class="d-flex justify-content-between align-items-center">
                                    <span class="fw-bold text-success small">‚Çπ{{ "%.2f"|format(book.price) }}</span>
                                    {% if book.categories %}
                                      <span class="badge bg-primary bg-opacity-10 text-primary" style="font-size: 0.7rem;">{{ book.categories[0].name }}</span>
                                    {% endif %}
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      {% endfor %}
                    </div>
                    <div class="mt-3 pt-2 border-top">
                      <div class="d-flex flex-column gap-2">
                        <small class="text-muted">
                          <i class="bi bi-info-circle me-1"></i>
                          {{ item.books|length }} books ‚Ä¢ Individual total: ‚Çπ{{ "%.2f"|format(item.books|sum(attribute='price')) }}
                        </small>
                        <span class="badge bg-success align-self-start">
                          <i class="bi bi-tag me-1"></i>
                          You save: ‚Çπ{{ "%.2f"|format((item.books|sum(attribute='price')) - item.price) }}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% elif item.get('type') == 'course' %}
            <!-- Mobile Course Card -->
            <div class="card mb-3 border-0 shadow-sm">
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-3">
                    {% if item.image %}
                      <img src="{{ url_for('static', filename='uploads/courses/' ~ item.image) }}" 
                           alt="{{ item.title }}" 
                           class="img-fluid rounded"
                           style="height: 80px; object-fit: contain;">
                    {% else %}
                      <div class="bg-light rounded d-flex align-items-center justify-content-center" 
                           style="height: 80px;">
                        <i class="bi bi-play-circle text-muted"></i>
                      </div>
                    {% endif %}
                  </div>
                  <div class="col-9">
                    <h6 class="mb-1 fw-semibold">{{ item.title }}</h6>
                    <p class="mb-1 text-muted small">Certificate Course</p>
                    <div class="mb-2">
                      <span class="badge bg-success me-1">Course</span>
                      <span class="badge bg-secondary">Online Learning</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <span class="fw-bold text-success">‚Çπ{{ "%.2f"|format(item.price) }}</span>
                        <span class="text-muted"> √ó {{ item.quantity }}</span>
                      </div>
                      <div>
                        <span class="fw-bold me-2">‚Çπ{{ "%.2f"|format(item_total) }}</span>
                        <a href="{{ url_for('remove_from_cart_generic', item_type='course', item_id=item.id) }}" 
                           class="btn btn-outline-danger btn-sm">
                          <i class="bi bi-trash"></i>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <!-- Mobile Book Card -->
            <div class="card mb-3 border-0 shadow-sm">
              <div class="card-body">
                <div class="row align-items-center">
                  <div class="col-3">
                    {% if item.image %}
                      <img src="{{ url_for('static', filename='uploads/books/' ~ item.image) }}" 
                           alt="{{ item.title }}" 
                           class="img-fluid rounded"
                           style="height: 80px; object-fit: contain;">
                    {% else %}
                      <div class="bg-light rounded d-flex align-items-center justify-content-center" 
                           style="height: 80px;">
                        <i class="bi bi-book text-muted"></i>
                      </div>
                    {% endif %}
                  </div>
                  <div class="col-9">
                    <h6 class="mb-1 fw-semibold">{{ item.title }}</h6>
                    <p class="mb-1 text-muted small">by {{ item.author }}</p>
                    <div class="mb-2">
                      <span class="badge bg-primary me-1">{{ item.category }}</span>
                      <span class="badge bg-secondary">{{ item.subject }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                      <div>
                        <span class="fw-bold text-success">‚Çπ{{ "%.2f"|format(item.price) }}</span>
                        <span class="text-muted"> √ó {{ item.quantity }}</span>
                      </div>
                      <div>
                        <span class="fw-bold me-2">‚Çπ{{ "%.2f"|format(item_total) }}</span>
                        <a href="{{ url_for('remove_from_cart_generic', item_type='book', item_id=item.id) }}" 
                           class="btn btn-outline-danger btn-sm">
                          <i class="bi bi-trash"></i>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          {% endif %}
        {% endfor %}
        
        <!-- Mobile Total -->
        <div class="card border-0 shadow-sm bg-light">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0 fw-bold">Grand Total:</h5>
              <h4 class="mb-0 fw-bold text-success">‚Çπ{{ "%.2f"|format(grand_total.value) }}</h4>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="row mt-4">
        <div class="col-12 col-md-6 mb-3 mb-md-0">
          <a href="{{ url_for('books') }}" class="btn btn-outline-primary btn-lg w-100">
            <i class="bi bi-arrow-left me-2"></i>Continue Shopping
          </a>
        </div>
        <div class="col-12 col-md-6">
          <a href="{{ url_for('checkout') }}" class="btn btn-success btn-lg w-100">
            <i class="bi bi-credit-card me-2"></i>Proceed to Checkout
          </a>
        </div>
      </div>

      {% else %}
        <!-- Empty Cart Message -->
        <div class="text-center py-5">
          <div class="mb-4">
            <i class="bi bi-cart-x" style="font-size: 4rem; color: #6c757d;"></i>
          </div>
          <h3 class="h4 text-muted mb-3">Your cart is empty</h3>
          <p class="text-muted mb-4">
            Discover amazing books and start building your collection!
          </p>
          <a href="{{ url_for('books') }}" class="btn btn-primary btn-lg">
            <i class="bi bi-book me-2"></i>Browse Books
          </a>
        </div>
      {% endif %}
    </div>
  </div>
</div>
<style>
/* --------- Floating Button ---------- */
.shadow-floating-chat {
  position: fixed; bottom: 20px; right: 20px;
  box-shadow: 0 4px 18px rgba(13,110,253,0.25);
  width: 54px; height: 54px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.8rem;
  border-radius: 50%;
  background: #0d6efd;
  color: #fff;
  cursor: pointer;
  transition: box-shadow 0.25s, transform 0.1s;
  z-index: 1050;
}
.shadow-floating-chat:hover {
  transform: scale(1.08);
  box-shadow: 0 8px 24px rgba(13,110,253,0.35);
}

/* --------- Chatbot Box ---------- */
.chatbot-box {
  position: fixed;
  bottom: 80px;
  right: 20px;
  width: 300px;   /* default (tablet) */
  height: 380px;  /* default (tablet) */
  max-width: 95vw;
  max-height: 80vh;
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 12px 32px rgba(0,0,0,0.15);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  transform: translateY(30px);
  opacity: 0;
  pointer-events: none;
  transition: all 0.3s ease;
  z-index: 1060;
}
.chatbot-box.show {
  transform: translateY(0);
  opacity: 1;
  pointer-events: auto;
}

/* --------- Chat Header ---------- */
.chatbot-header {
  background: #0d6efd;
  color: #fff;
  padding: 8px 12px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.chatbot-header img {
  border-radius: 50%;
  margin-right: 6px;
}

/* --------- Chat Body ---------- */
.chatbot-body {
  flex: 1;
  padding: 8px;
  overflow-y: auto;
  background: #f8f9fa;
}

/* --------- Messages ---------- */
.msg-bubble {
  max-width: 75%;
  border-radius: 15px;
  padding: 8px 12px;
  font-size: 0.95rem;
  margin-bottom: 6px;
  animation: bubbleSlideIn 0.25s ease;
}
.chat-message { display: flex; margin-bottom: 6px; }
.user-msg { justify-content: flex-end; }
.bot-msg { justify-content: flex-start; }
.user-msg .msg-bubble {
  background: linear-gradient(135deg, #0d6efd 90%, #3db0ef 100%);
  color: #fff;
  border-bottom-right-radius: 0;
}
.bot-msg .msg-bubble {
  background: #fff;
  border: 1px solid #dee2e6;
  color: #212529;
  border-bottom-left-radius: 0;
}

/* --------- Input Area ---------- */
.chatbot-footer {
  padding: 6px;
  border-top: 1px solid #dee2e6;
  display: flex;
  gap: 6px;
}
#userInput {
  flex: 1;
  border-radius: 10px;
  border: 1px solid #dee2e6;
  padding: 5px 8px;
  font-size: 0.9rem;
}
#userInput:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 2px rgba(13,110,253,0.1);
}
.send-btn {
  background: #0d6efd;
  border: none;
  color: #fff;
  padding: 5px 10px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: background 0.2s;
}
.send-btn:hover { background: #0b5ed7; }

/* --------- Responsive ---------- */
/* Desktop (large) */
@media (min-width: 992px) {
  .chatbot-box {
    width: 340px;
    height: 420px;
  }
}

/* Mobile (small) */
@media (max-width: 480px) {
  .chatbot-box {
    right: 10px;
    bottom: 70px;
    width: 90vw;
    height: 70vh;
  }
}
</style>


<!-- Floating Chat Button -->
<div class="shadow-floating-chat" id="chatToggle">üí¨</div>

<!-- Chatbot Box -->
<div class="chatbot-box" id="chatBox">
  <div class="chatbot-header">
    <div class="d-flex align-items-center">
      <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-chat/ava1-bg.webp" width="28" alt="Bot">
      <strong>Easy2Learning Chatbot</strong>
    </div>
    <button class="btn-close btn-close-white" id="chatClose"></button>
  </div>
  <div class="chatbot-body" id="chatBody">
    <div class="bot-msg chat-message">
      <div class="msg-bubble">
        Hi! Welcome to Easy2learning ‚Äî your trusted destination for engineering and competitive exam coaching.<br>
        üìû +91 85848 64783<br>
        Type <b>courses</b> to see our course list.
      </div>
    </div>
  </div>
  <div class="chatbot-footer">
    <input type="text" id="userInput" placeholder="Type your message..." autocomplete="off">
    <button class="send-btn" onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
const chatToggle = document.getElementById("chatToggle");
const chatBox = document.getElementById("chatBox");
const chatClose = document.getElementById("chatClose");
const chatBody = document.getElementById("chatBody");
const userInput = document.getElementById("userInput");

chatToggle.addEventListener("click", () => {
  chatBox.classList.toggle("show");
});
chatClose.addEventListener("click", () => {
  chatBox.classList.remove("show");
});

const botReplies = [
  {
    triggers: ['hi', 'hello', 'hey', 'good morning', 'good evening'],
    reply: `Hi!<br>Welcome to Easy2learning ‚Äî your trusted destination for engineering and competitive exam coaching.<br>
    üìû Contact us: +91 85848 64783<br>
    Feel free to reach out with any questions.<br>
    If you‚Äôd like to know about our courses, just type <b>courses</b>.`
  },
  {
    triggers: ['courses', 'course list', 'show me your courses', 'what courses do you offer'],
    reply: `We offer the following courses at Easy2learning:<br><br>
    <b>Foundation Courses:</b><br>‚Ä¢ All Diploma Courses (Semester-wise)<br>‚Ä¢ B.Tech Courses (Semester-wise)<br><br>
    <b>Certificate Courses:</b><br>‚Ä¢ AutoCAD<br>‚Ä¢ Solar Internship<br>‚Ä¢ Software Courses<br><br>
    <b>Competitive Exams Preparation:</b><br>‚Ä¢ JEE (Main & Advanced)<br>‚Ä¢ SSC-JE<br>‚Ä¢ RRB-JE<br>‚Ä¢ WBSEDCL<br>‚Ä¢ WBSETCL<br>‚Ä¢ WBPSC-JE<br>‚Ä¢ WBJEE & Other State Engineering Entrance Exams<br><br>
    Want to know more about any specific course? Just type the course name (e.g., JEE, AutoCAD, WBJEE, etc.)<br><br>
    üì≤ Download Our Apps:<br>
    ‚Ä¢ <a href="https://play.google.com/store/apps/details?id=com.easy2learning2.appx" target="_blank">Diploma Students App</a><br>
    ‚Ä¢ <a href="https://play.google.com/store/apps/details?id=co.edvin.ubglj" target="_blank">B-Tech & JELET App</a>`
  },
  {
    triggers: ['jee', 'jee main', 'jee advanced'],
    reply: `Our <b>JEE (Main & Advanced)</b> program is designed for serious aspirants aiming for top engineering colleges.<br><br>
    ‚Ä¢ Faculty from IITs & NITs<br>
    ‚Ä¢ Mock Tests & Performance Analysis<br>
    ‚Ä¢ One-on-one doubt sessions<br>
    ‚Ä¢ Study material with PYQs<br>
    ‚Ä¢ Personalised attention & strategic mentoring<br><br>
    üìû Call us for more info: +91 85848 64783`
  },
  {
    triggers: ['diploma', 'diploma courses'],
    reply: `We offer semester-wise coaching for all Diploma engineering subjects.<br><br>
    ‚Ä¢ Conceptual clarity & exam-focused teaching<br>
    ‚Ä¢ One-on-one doubt clearing<br>
    ‚Ä¢ Weekly assessments & progress tracking<br><br>
    üì≤ <a href="https://play.google.com/store/apps/details?id=com.easy2learning2.appx" target="_blank">Want to know more about the course? Click here</a>`
  },
  {
    triggers: ['btech', 'b.tech', 'btech course'],
    reply: `Our <b>B.Tech</b> semester-wise coaching helps students with university and competitive exam preparation.<br><br>
    ‚Ä¢ Topic-wise lectures<br>
    ‚Ä¢ Smart classroom support<br>
    ‚Ä¢ Study materials & assignments<br><br>
    üì≤ <a href="https://play.google.com/store/apps/details?id=co.edvin.ubglj" target="_blank">Want to know more about the course? Click here</a>`
  },
  {
    triggers: ['autocad'],
    reply: `Our <b>AutoCAD</b> certificate course includes:<br><br>
    ‚Ä¢ Hands-on practical training<br>
    ‚Ä¢ Real-time projects<br>
    ‚Ä¢ Certificate upon completion<br>
    ‚Ä¢ Expert instructors<br><br>
    üìû Call us to enroll: +91 85848 64783`
  },
  {
    triggers: ['wbjee', 'state entrance'],
    reply: `Get ready for <b>WBJEE & other State Engineering Entrance Exams</b> with our expert-designed program.<br><br>
    ‚Ä¢ Subject-wise coaching<br>
    ‚Ä¢ Exam-focused strategies<br>
    ‚Ä¢ Mock tests & practice sessions<br>
    ‚Ä¢ Doubt-clearing support<br><br>
    üìû Contact us for guidance: +91 85848 64783`
  },
  {
    triggers: ['ssc-je', 'rrb-je', 'wbsedcl', 'wbpsc-je', 'wbsetcl'],
    reply: `We provide dedicated coaching for technical government exams like <b>SSC-JE, RRB-JE, WBSEDCL, WBSETCL, and WBPSC-JE</b>.<br><br>
    ‚Ä¢ Syllabus-wise structured classes<br>
    ‚Ä¢ Previous year questions<br>
    ‚Ä¢ Technical concept clearing<br>
    ‚Ä¢ Mock tests & assignments<br><br>
    üìû Call us to join: +91 85848 64783`
  },
  {
    triggers: ['about', 'about you', 'about easy2learning', 'who are you'],
    reply: `Easy2learning is a premier coaching institute for engineering and competitive exams.<br><br>
    We help students achieve top results through:<br>
    ‚Ä¢ Academic excellence<br>
    ‚Ä¢ Expert faculty from IITs, NITs & PhDs<br>
    ‚Ä¢ One-on-one doubt sessions<br>
    ‚Ä¢ Mock tests & personalised mentoring<br>
    ‚Ä¢ Scholarships & affordable fees<br><br>
    üìû Phone: +91 85848 64783<br>
    üìß Email: contact@easy2learning.in<br>
    üìç Address: 19D, Bhagabati Chatterjee St, Belghariya, Kolkata`
  },
  {
    triggers: ['i want to join a course', 'classes', 'class info', 'can you tell me about your classes', 'i want to know about your courses'],
    reply: `We offer a wide range of programs including Diploma & B.Tech coaching, competitive exam prep (like JEE, SSC-JE), and certificate courses (AutoCAD, Solar Internship, etc.)<br><br>
    üì≤ Download our apps:<br>
    ‚Ä¢ <a href="https://play.google.com/store/apps/details?id=com.easy2learning2.appx" target="_blank">Diploma App</a><br>
    ‚Ä¢ <a href="https://play.google.com/store/apps/details?id=co.edvin.ubglj" target="_blank">B-Tech & JELET App</a><br><br>
    üåê Explore full course info: <a href="#" target="_blank">Visit Website</a><br><br>
    Need info on a specific course? Just type the course name!`
  }
];

function sendMessage() {
  const userText = userInput.value.trim();
  if (!userText) return;

  const userMsg = document.createElement("div");
  userMsg.classList.add("chat-message","user-msg");
  userMsg.innerHTML = `<div class="msg-bubble">${userText}</div>`;
  chatBody.appendChild(userMsg);
  userInput.value = "";
  chatBody.scrollTop = chatBody.scrollHeight;

  const lowerText = userText.toLowerCase();
  const matchedReply = botReplies.find(item =>
    item.triggers.some(trigger => lowerText.includes(trigger))
  )?.reply;

  const botMsg = document.createElement("div");
  botMsg.classList.add("chat-message","bot-msg");
  botMsg.innerHTML = `<div class="msg-bubble">...</div>`;
  chatBody.appendChild(botMsg);
  chatBody.scrollTop = chatBody.scrollHeight;

  setTimeout(() => {
    botMsg.innerHTML = `<div class="msg-bubble">${matchedReply || "Sorry, I didn‚Äôt catch that. Try <b>courses</b> or <b>about</b>."}</div>`;
    chatBody.scrollTop = chatBody.scrollHeight;
  }, 700);
}

userInput.addEventListener("keypress", function(e) {
  if (e.key === "Enter") sendMessage();
});
</script>




<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}